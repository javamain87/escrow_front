import{m as T,f as n,h as O,c as a,a as t,n as b,j as u,t as v,p as g,F as S,q as C,g as R,k as A,l as B,u as j,o as l}from"./index-CLtsJ1Nk.js";import{a as x,b as q}from"./axios-BqJF4kvB.js";const U={class:"min-h-screen bg-gradient-to-b from-[#f8f9ff] to-[#e0eaff] text-[#1c1e21] px-6 py-10"},$={class:"max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-8"},F={class:"flex gap-4 mb-4 justify-center"},Y={class:"space-y-6"},z={class:"grid grid-cols-2 gap-4"},W={class:"p-4 border rounded-lg bg-gray-50"},J={class:"p-4 border rounded-lg bg-gray-50"},K={key:0},Q={key:0},X={class:"flex justify-around text-center"},Z={class:"text-sm"},ee={key:1},te={key:2,class:"mt-4 text-center"},se={key:1},ae={key:0},le={class:"space-y-2"},oe={class:"font-medium text-gray-600"},re={key:1,class:"text-center text-sm text-gray-500"},ne={class:"flex gap-4 mt-6 justify-center"},ue={key:2,class:"mt-8 text-center"},ve={__name:"Step3",setup(ie){const E=T(),h=j(),i=E.query.tradeCode,I=E.query.tradePassword,o=E.query.role,m=n(!1),p=n(!1),f=n(""),d=n(""),P=n(""),_=n([]),c=n("status"),w=n([{label:"배송 준비중",value:"SHIPPING_PREP",active:!1},{label:"배송 시작",value:"SHIPPING",active:!1},{label:"배송 완료",value:"DELIVERED",active:!1}]),y=async()=>{if(!i||!I||!o){alert("접근 정보가 누락되었습니다."),h.push("/step3_login");return}try{const r=await x("/api/payment/access",{tradeCode:i,tradePassword:I,role:o}),{trade:e,tradeDetail:s}=r.data;f.value=e.status,m.value=["SELLER_APPROVED","BUYER_PAID","SHIPPING_PREP","SHIPPING","DELIVERED","COMPLETED"].includes(e.status),p.value=["BUYER_PAID","SHIPPING_PREP","SHIPPING","DELIVERED","COMPLETED"].includes(e.status),s&&(d.value=s.deliveryStatus||"",P.value=s.specialNote||""),L()}catch{alert("접근 권한이 없거나 거래 정보를 찾을 수 없습니다."),h.push("/step3_login")}},L=()=>{const r=w.value.findIndex(e=>e.value===d.value);w.value.forEach((e,s)=>{e.active=r>=s})},k=async()=>{try{const r=await q(`/api/payment/history?tradeCode=${i}`);_.value=r.data||[]}catch(r){console.error("📛 특이사항 이력 조회 실패",r)}},N=async()=>{o==="seller"&&(await x("/api/payment/approve-seller",{tradeCode:i}),y())},H=async()=>{o==="buyer"&&(await x("/api/payment/confirm-payment",{tradeCode:i}),y())},V=async()=>{await x("/api/payment/update-status",{tradeCode:i,role:o,status:d.value,deliveryStatus:d.value,specialNote:P.value}),alert("특이사항이 정상적으로 저장되었습니다."),y(),k()},G=async()=>{await x("/api/payment/update-status",{tradeCode:i,role:o,status:"COMPLETED"}),y(),k()},M=()=>{h.push("/")};return O(()=>{y(),k()}),(r,e)=>(l(),a("section",U,[t("div",$,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold mb-6 text-center"},"거래 진행 상황",-1)),t("div",F,[t("button",{class:b([c.value==="status"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700","px-4 py-2 rounded"]),onClick:e[0]||(e[0]=s=>c.value="status")}," 배송 현황 ",2),t("button",{class:b([c.value==="history"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700","px-4 py-2 rounded"]),onClick:e[1]||(e[1]=s=>c.value="history")}," 배송 내역 ",2)]),t("div",Y,[t("div",z,[t("div",W,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold mb-2"},"판매자 승인 상태",-1)),t("p",{class:b(m.value?"text-green-600":"text-yellow-600")},v(m.value?"✅ 판매자 승인 완료":"⏳ 판매자 승인 대기 중"),3)]),t("div",J,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold mb-2"},"구매자 입금 상태",-1)),t("p",{class:b(p.value?"text-green-600":"text-yellow-600")},v(p.value?"✅ 입금 완료":"⏳ 입금 대기 중"),3)])]),c.value==="status"?(l(),a("div",K,[g(o)==="buyer"?(l(),a("div",Q,[e[6]||(e[6]=t("h3",{class:"text-lg font-bold mb-3"},"배송 상태",-1)),t("div",X,[(l(!0),a(S,null,C(w.value,(s,D)=>(l(),a("div",{key:D,class:"flex flex-col items-center"},[t("div",{class:b(["w-10 h-10 rounded-full flex items-center justify-center mb-1",{"bg-blue-600 text-white":s.active,"bg-gray-300 text-gray-600":!s.active}])},v(D+1),3),t("span",Z,v(s.label),1)]))),128))])])):u("",!0),g(o)==="seller"&&p.value&&f.value!=="COMPLETED"?(l(),a("div",ee,[e[8]||(e[8]=t("label",{class:"block font-semibold mb-2"},"배송 상태 선택",-1)),R(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>d.value=s),class:"w-full border p-2 rounded"},e[7]||(e[7]=[t("option",{value:"SHIPPING_PREP"},"배송 준비중",-1),t("option",{value:"SHIPPING"},"배송 시작",-1),t("option",{value:"DELIVERED"},"배송 완료",-1)]),512),[[A,d.value]]),e[9]||(e[9]=t("label",{class:"block font-semibold mt-4 mb-2"},"특이사항 입력",-1)),R(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>P.value=s),placeholder:"예: 상품 박스가 훼손되었습니다",class:"w-full border p-2 rounded"},null,512),[[B,P.value]]),t("button",{onClick:V,class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," 배송 상태 업데이트 ")])):u("",!0),g(o)==="buyer"&&d.value==="DELIVERED"&&f.value!=="COMPLETED"?(l(),a("div",te,[t("button",{onClick:G,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," 상품 수령 완료 ")])):u("",!0)])):u("",!0),c.value==="history"?(l(),a("div",se,[_.value.length?(l(),a("div",ae,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold mb-2"},"판매자 특이사항 이력",-1)),t("ul",le,[(l(!0),a(S,null,C(_.value,s=>(l(),a("li",{key:s.id,class:"text-sm text-gray-700 border p-3 rounded-md"},[t("div",oe," 🕒 "+v(s.createdAt),1),t("div",null,v(s.content),1)]))),128))])])):(l(),a("div",re," 등록된 내역이 없습니다. "))])):u("",!0),t("div",ne,[g(o)==="seller"&&!m.value?(l(),a("button",{key:0,onClick:N,class:"py-2 px-4 bg-purple-600 text-white rounded hover:bg-purple-700"}," 판매자 승인 ")):u("",!0),g(o)==="buyer"&&!p.value?(l(),a("button",{key:1,onClick:H,class:"py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700"}," 구매자 입금 ")):u("",!0)]),f.value==="COMPLETED"?(l(),a("div",ue,[e[11]||(e[11]=t("p",{class:"text-lg font-semibold text-blue-600 mb-4"}," 🎉 거래가 성공적으로 완료되었습니다! ",-1)),t("button",{onClick:M,class:"py-3 px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," 완료 ")])):u("",!0)])])]))}};export{ve as default};
